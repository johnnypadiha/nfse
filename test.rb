require 'savon'
#require 'nokogiri'
require 'httpclient'

# create a client for the service
client = Savon.client(wsdl: 'https://nfse.goiania.go.gov.br/ws/nfse.asmx?wsdl')

puts client.operations

@xml = "<?xml version='1.0'?>
<GerarNfseEnvio xmlns='http://nfse.goiania.go.gov.br/xsd/nfse_gyn_v02.xsd'><Rps><InfDeclaracaoPrestacaoServico><Rps><IdentificacaoRps><Numero>18</Numero><Serie>UNICA</Serie><Tipo>1</Tipo></IdentificacaoRps><DataEmissao>2011-11-16T00:00:00</DataEmissao><Status>1</Status></Rps><Servico><Valores><ValorServicos>2000.00</ValorServicos><ValorPis>40.50</ValorPis><ValorCofins>20.00</ValorCofins><ValorInss>10.50</ValorInss><ValorCsll>30.00</ValorCsll></Valores><CodigoTributacaoMunicipio>551080100</CodigoTributacaoMunicipio><Discriminacao>TESTE DE WEBSERVICE RETIDO</Discriminacao><CodigoMunicipio>2530000</CodigoMunicipio></Servico><Prestador><CpfCnpj><Cpf>24329550130</Cpf></CpfCnpj><InscricaoMunicipal>1300687</InscricaoMunicipal></Prestador><Tomador><IdentificacaoTomador><CpfCnpj><Cnpj>06926334000177</Cnpj></CpfCnpj><InscricaoMunicipal>2118513</InscricaoMunicipal></IdentificacaoTomador><RazaoSocial>GRAMADO EMPREENDIMENTOS</RazaoSocial><Endereco><Endereco>RUA 3</Endereco><Numero>1003</Numero><Complemento>1003</Complemento><Bairro>CAPUAVA</Bairro><CodigoMunicipio>2530000</CodigoMunicipio><Uf>GO</Uf></Endereco></Tomador></InfDeclaracaoPrestacaoServico><Signature xmlns='http://www.w3.org/2000/09/xmldsig#'><SignedInfo><CanonicalizationMethod Algorithm='http://www.w3.org/TR/2001/REC-xml-c14n-20010315'/><SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1'/><Reference URI=''><Transforms><Transform Algorithm='http://www.w3.org/2000/09/xmldsig#enveloped-signature'/><Transform Algorithm='http://www.w3.org/TR/2001/REC-xml-c14n-20010315'/></Transforms><DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1'/><DigestValue>Rx/dhFhnjN/6mxk02LrNmpvM5lU=</DigestValue></Reference></SignedInfo><SignatureValue>Y3UQi0Q4GKEuhGejjl44TSlXG6JZ4OPrVS+2usbXU3ikthwfGsMfCOcyjIV2b14+XOgM2dCllR+qi89s2YhCkO8zHpOGmzmB3DHC6QuvYq+aO+5MF23p0JXGnJ6OCFQo7rJkBqMf2qrZAXFsDn2HB8U6DAWFJezmzXCr4h8T2uM=</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></Rps></GerarNfseEnvio>"


#doc = Nokogiri::XML @xml
#xml2 =  doc.to_xml


#response = client.call(:gerar_nfse, message: { :ArquivoXML => @xml })
#response = client.call(:gerar_nfse, message: { ArquivoXML: @xml })
#response = client.call(:gerar_nfse, message: { :ArquivoXML => xml2 })
resposta = client.call(:gerar_nfse, soap_action: "", message: { :ArquivoXML => @xml })
puts response.body
